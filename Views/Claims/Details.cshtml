@model ClaimSystem.Models.Claim
@using ClaimSystem.Models
@{
    ViewData["Title"] = "Claim Details";
}
<h1>Claim @Model.Id</h1>
<p><b>@Model.LecturerName</b> • @Model.ModuleCode • @Model.Year-@Model.Month.ToString("00")</p>
<p>Status: <span class="badge bg-primary">@Model.Status</span> • Total: <b>R @Model.TotalAmount.ToString("N2")</b></p>

<h4 class="mt-4">Add Line Item</h4>
<form asp-action="AddLineItem" method="post" class="row g-2">
    <input type="hidden" name="claimId" value="@Model.Id" />
    <div class="col-md-3"><input name="Date" type="date" class="form-control" /></div>
    <div class="col-md-2"><input name="Hours" type="number" step="0.25" class="form-control" placeholder="Hours" /></div>
    <div class="col-md-2"><input name="RatePerHour" type="number" step="0.01" class="form-control" placeholder="Rate" /></div>
    <div class="col-md-3"><input name="Notes" class="form-control" placeholder="Notes" /></div>
    <div class="col-md-2"><button class="btn btn-outline-primary" type="submit">Add</button></div>
</form>

<table class="table table-sm mt-3">
    <thead><tr><th>Date</th><th>Hours</th><th>Rate</th><th>Amount</th><th>Notes</th></tr></thead>
    <tbody>
        @foreach (var li in Model.LineItems)
        {
            <tr><td>@li.Date.ToString("yyyy-MM-dd")</td><td>@li.Hours</td><td>@li.RatePerHour</td><td>@li.Amount</td><td>@li.Notes</td></tr>
        }
    </tbody>
</table>

<h4 class="mt-4">Upload Supporting Document</h4>
<form asp-action="Upload" method="post" enctype="multipart/form-data">
    <input type="hidden" name="claimId" value="@Model.Id" />
    <input type="file" name="file" class="form-control" />
    <button class="btn btn-outline-secondary mt-2">Upload</button>
</form>

<ul class="list-group mt-2">
    @foreach (var d in Model.Documents)
    {
        <li class="list-group-item d-flex justify-content-between">
            <span>@d.FileName (@(Math.Round(d.SizeBytes / 1024.0)) KB)</span>
            <a class="btn btn-sm btn-link" href="@d.StoragePath" target="_blank">View</a>
        </li>
    }
</ul>

<h4 class="mt-4">Submit / Review</h4>
<form asp-action="SetStatus" method="post" class="d-flex gap-2">
    <input type="hidden" name="id" value="@Model.Id" />
    <select name="status" class="form-select w-auto">
        <option value="@ClaimStatus.Draft">Draft</option>
        <option value="@ClaimStatus.Submitted">Submitted</option>
        <option value="@ClaimStatus.UnderReview">UnderReview</option>
        <option value="@ClaimStatus.Approved">Approved</option>
        <option value="@ClaimStatus.Rejected">Rejected</option>
    </select>
    <button class="btn btn-warning">Update Status</button>
</form>

<a class="btn btn-secondary mt-3" asp-action="Index">Back</a>
